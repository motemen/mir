box: tcnksm/gox
build:
  steps:
    - setup-go-workspace

    - script:
        name: go get
        code: |
          go get
    - script:
        name: go test
        code: |
          go test -v ./...
          go test -v -race ./...
    - wercker/gox:
        os: linux
        arch: amd64
        output: '{{.Dir}}_{{.OS}}_{{.Arch}}/{{.Dir}}'
        dest: $WERCKER_OUTPUT_DIR/pkg
    - script:
        name: build race version
        code: |
          go build -race -o $WERCKER_OUTPUT_DIR/pkg/mir_linux_amd64_race/mir
    - tcnksm/zip:
        input: $WERCKER_OUTPUT_DIR/pkg
        output: $WERCKER_OUTPUT_DIR/dist
deploy:
  steps:
    - tcnksm/ghr:
        token: $GITHUB_TOKEN
        input: dist
        replace: true
